#/usr/bin/env python3

from tkinter import *
from tkinter import ttk

blocks = [ 
    [ [ 0, 0] ],
    [ [ 0, 0], [0, 1] ],
    [ [ 0, 0], [0, 1], [0, 2] ],
    [ [ 0, 0], [0, 1], [0, 2], [0, 3]],
    [ [ 0, 0], [0, 1], [0, 2], [0, 3], [0, 4]],
    ]

blocks2 = [
    #D1
    [
        [   
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #D2
    [
        [
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],
    
    #D3
    [   
        [
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #D4
    [
        [
            [ 1, 1, 1, 1, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #D5
    [
        [
            [ 1, 1, 1, 1, 1 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
        ]
    ],

    #ㄱ2
    [
        [
            [ 1, 1, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #ㄱ3
    [
        [
            [ 1, 1, 1, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 0, 1, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #ㄱ4
    [
        [
            [ 1, 1, 1, 1, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 0, 0, 1, 0 ],
            [ 1, 1, 1, 1, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #ㄱ5
    [
        [
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 1, 0, 0 ],
            [ 0, 0, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 0, 1, 0, 0 ],
            [ 0, 0, 1, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 1, 1, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #SQ
    [
        [
            [ 1, 1, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ]
    ],
    
    #smallT
    [
        [
            [ 1, 1, 1, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #ㄹ
    [
        [
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #STAR
    [
        [
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #W
    [
        [
            [ 0, 1, 1, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 1, 0, 0 ],
            [ 0, 0, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #T
    [
        [
            [ 1, 1, 1, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 0, 1, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #O1
    [
        [
            [ 1, 1, 1, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 1, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 1, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #O2
    [
        [
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 1, 1, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 1, 1, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #O3
    [
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 1, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #O4
    [
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 1, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 1, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #O5
    [
        [
            [ 1, 1, 1, 1, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 0, 0, 1, 0, 0 ],
            [ 1, 1, 1, 1, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ],

    #O6
    [
        [
            [ 1, 1, 1, 0, 0 ],
            [ 1, 0, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 1, 0, 0, 0 ],
            [ 0, 1, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 0, 1, 0, 0 ],
            [ 1, 1, 1, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
        [
            [ 1, 1, 0, 0, 0 ],
            [ 1, 0, 0, 0, 0 ],
            [ 1, 1, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
            [ 0, 0, 0, 0, 0 ],
        ],
    ]
]

space = [
    [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
    [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
    [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
    [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
    [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
    [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
    [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
    [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ],
    [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]
]

def sum_of_blocks():
    sum = 0

    for i in range(0, len(blocks2)):
        for x in range(0, 5):
            #print(f"x : {x}")
            for y in range(0, 5):
                #print(f"y : {y}")
                if blocks2[i][0][y][x] == 1:
                    #print(f"{x},{y} ", end='')
                    sum = sum + 1
    return sum

def draw_point(canvas, id, x, y):
    text = f"id"
    canvas.create_rectangle(x*10, y*10, x*10+8, y*10+8)
    canvas.create_text(x*10, y*10, text)

def draw_test(canvas):
    for i in range(0, len(blocks2)):
        #print(f"{i}th shape")
        startX = int(i / 5) * 6
        startY = (i % 5) * 6
        #print(f"startX : {startX}, startY : {startY}")
        for x in range(0, 5):
            #print(f"x : {x}")
            for y in range(0, 5):
                #print(f"y : {y}")
                if blocks2[i][y][x] == 1:
                    #print(f"{x},{y} ", end='')
                    draw_point(canvas, startX + x + 1, startY + y + 1)

def draw_space(canvas):
    for x in range(0, 10):
        for y in range(0, 9):
            if space[y][x] != 0:
                draw_point(canvas, space[y][x], x, y)

def is_valid(id, rotate, startX, startY):
    if rotate > len(blocks2[id]):
        return False

    for x in range(0,5):
        for y in range(0,5):
            if blocks2[id][rotate][y][x] == 0:
                continue
            if startY+y > 8 or startX+x > 9:
                return False
            print(f"id:{id}, rotate:{rotate}, X : {startX} + {x}, Y : {startY} + {y}")
            if space[startY+y][startX+x] != 0:
                return False

    return True

def set_block(id, rotate, startX, startY):
    if rotate > len(blocks2[id]):
        return False

    for x in range(0,5):
        for y in range(0,5):
            if blocks2[id][rotate][y][x] == 0:
                continue
            if space[startY+y][startX+x] != 0:
                return False
            space[startY+y][startX+x] = rotate < 4 + id 

def clear_block(id, rotate, startX, startY):
    if rotate > len(blocks2[id]):
        return False

    for x in range(0,5):
        for y in range(0,5):
            if blocks2[id][rotate][y][x] == 0:
                continue
            if space[startY+y][startX+x] == 0:
                return False
            space[startY+y][startX+x] = 0

def search_matched(id):
    if id >= len(blocks2):
        return True

    for id in range(0, len(blocks2)):
        for rotate in range(0, len(blocks2[id])):
            for x in range(0,10):
                for y in range(0,9):
                    if is_valid(id, rotate, x, y):
                        set_block(id, rotate, x, y)
                        draw_space(canvas)
                        if search_matched(id+1):
                            print(f"ID:{id} Rotate:{rotate} X:{x} Y:{y}")
                        clear_block(id, rotate, x, y)

    return False

print(f"Sum : {sum_of_blocks()}")

root = Tk()
root.title = "Blokus"
root.geometry("800x800")

#frm = ttk.Frame(root, padding=10, width=800, height=800)
#frm.grid()

canvas = Canvas(root, width=10, height=10, bg="light blue", bd=3)
canvas.pack(fill="both", expand=True)

search_matched(0)

#ttk.Label(frm, text="Hello World!").grid(column=0, row=0)
#ttk.Button(frm, text="Quit", command=root.destroy).grid(column=1, row=0)
root.mainloop()